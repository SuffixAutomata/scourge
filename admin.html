<!DOCTYPE html>
<html lang="en">
  <body>
    <div id="connect">Disconnected</div>
    <div style="height: 0.3em;">&nbsp;</div>
    
    <div id="log" style="background: #eee; padding: 0.5em; overflow-y: visible; overflow: scroll; height: 80%"></div>

    <div style="display: flex;">
      <input id="message" type="text" placeholder="Enter command" style="flex: 1;" /> 
      <button id="send">send command</button>
    </div>
  </body>
  <script>
    var ws, E = function(id) { return document.getElementById(id); };
    var url = "/admin-websocket";
    var connect = E('connect'), message = E('message'), send = E('send'), log = E('log');
    var enable = function(en) { 
      message.disabled = send.disabled = !en; url.disabled = en; 
      connect.innerHTML = en ? 'Connected to Scourge backend' : 'Disconnected'; 
    };
    enable(false);
    var appendToLog = function(msg) { 
      log.innerHTML += msg + '<br/>';
      log.scrollTop = log.scrollHeight;
    };
    window.onload = function() {
      if (ws) { ws.close(); return; }
      ws = new WebSocket(url);
      if (!ws) return;
      ws.onopen = function() { appendToLog('CONNECTION OPENED'); }
      ws.onmessage = function(ev) { appendToLog('RECEIVED: ' + ev.data); }
      ws.onerror = function(ev) { appendToLog('ERROR: ' + ev); }
      ws.onclose = function() { appendToLog('CONNECTION CLOSED'); enable(false); ws = null; }
      enable(true);
    };
    send.onclick = function() {
      if (!ws) return;
      if(message.value == "close") ws.close();
      else {
        ws.send(message.value);
        appendToLog('SENT: ' + message.value);
        var v = document.getElementById("initformouter");
        if(v) v.remove();
      }
      message.value = "";
    }
    document.querySelector("#message").addEventListener("keyup", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        send.click();
      }
    });

    function handleInitForm(action) {
      // Disable all form elements
      // const formElements = document.querySelectorAll('input, textarea, button');
      // formElements.forEach(element => element.disabled = true);

      // Simulate form submission or autofill action
      if (action === 'submit') {
          // alert('Form submitted!');
          // Here you would typically send the form data to a server
      } else if (action === 'autofill') {
          // alert('Autofill triggered!');
          document.getElementById("autofilltextarea").style.width = "40%";
          document.getElementById("autofilltextarea").style.display = "";
          document.getElementById("initform").style.width = "55%";
          // Here you would typically populate the form fields with default or fetched data
      }
    }

    function toggleAdditionalOptions() {
      const additionalOptions = document.getElementById('additionalOptions');
      additionalOptions.style.display = document.querySelector('input[name="additionalOptions"]:checked').value === 'yes' ? 'block' : 'none';
      // document.getElementById("autofilltextarea").style.height = "100%";
    }
  </script>
</html>